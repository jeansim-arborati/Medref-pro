<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedRef Pro ‚Äî Banque d'Images M√©dicales</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,500;0,9..40,700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0b0f1a;
            --bg-card: #111827;
            --bg-elevated: #1a2234;
            --bg-hover: #1e2a3f;
            --border: #1e293b;
            --border-accent: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent: #38bdf8;
            --accent-glow: rgba(56, 189, 248, 0.15);
            --accent-warm: #f59e0b;
            --success: #34d399;
            --danger: #f87171;
            --tag-bg: rgba(56, 189, 248, 0.1);
            --tag-border: rgba(56, 189, 248, 0.25);
            --radius: 10px;
            --radius-lg: 16px;
            --shadow: 0 4px 24px rgba(0,0,0,0.3);
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ============ HEADER ============ */
        .app-header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(11, 15, 26, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
        }
        .header-top {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 0 12px;
            max-width: 1600px; margin: 0 auto;
        }
        .logo {
            display: flex; align-items: baseline; gap: 8px;
        }
        .logo-mark {
            font-family: 'Instrument Serif', serif;
            font-size: 1.7rem;
            color: var(--accent);
            letter-spacing: -0.02em;
        }
        .logo-sub {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-weight: 500;
        }
        .header-actions {
            display: flex; align-items: center; gap: 8px;
        }

        /* ============ TOOLBAR ============ */
        .toolbar {
            max-width: 1600px; margin: 0 auto;
            padding: 0 0 14px;
            display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
        }
        .search-box {
            flex: 1; min-width: 260px;
            position: relative;
        }
        .search-box svg {
            position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
            color: var(--text-muted); width: 18px; height: 18px; pointer-events: none;
        }
        .search-box input {
            width: 100%; padding: 10px 14px 10px 42px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
            transition: border var(--transition);
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        .search-box input::placeholder { color: var(--text-muted); }

        /* ============ FILTER CHIPS ============ */
        .filter-row {
            max-width: 1600px; margin: 0 auto;
            padding: 0 0 14px;
            display: flex; gap: 6px; flex-wrap: wrap;
            overflow-x: auto;
        }
        .chip {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 500;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all var(--transition);
            font-family: inherit;
        }
        .chip:hover { border-color: var(--text-muted); color: var(--text-primary); }
        .chip.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-deep);
        }
        .chip .count {
            display: inline-block;
            margin-left: 4px;
            font-size: 0.68rem;
            opacity: 0.7;
        }

        /* ============ STATS BAR ============ */
        .stats-bar {
            max-width: 1600px; margin: 0 auto;
            padding: 20px 24px;
            display: flex; gap: 16px; flex-wrap: wrap; align-items: center;
            justify-content: space-between;
        }
        .stats-left {
            display: flex; gap: 24px; align-items: center;
        }
        .stat-item {
            display: flex; align-items: baseline; gap: 6px;
        }
        .stat-value {
            font-family: 'Instrument Serif', serif;
            font-size: 1.6rem;
            color: var(--accent);
        }
        .stat-label {
            font-size: 0.78rem;
            color: var(--text-muted);
        }
        .view-toggles {
            display: flex; gap: 4px;
        }
        .view-btn {
            width: 36px; height: 36px;
            display: flex; align-items: center; justify-content: center;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-muted);
            cursor: pointer;
            transition: all var(--transition);
            font-family: inherit;
        }
        .view-btn:hover { border-color: var(--text-muted); color: var(--text-primary); }
        .view-btn.active { background: var(--accent); border-color: var(--accent); color: var(--bg-deep); }

        /* ============ BUTTONS ============ */
        .btn {
            padding: 9px 16px;
            border-radius: var(--radius);
            font-size: 0.82rem;
            font-weight: 500;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: pointer;
            display: inline-flex; align-items: center; gap: 6px;
            transition: all var(--transition);
            font-family: inherit;
            white-space: nowrap;
        }
        .btn:hover { border-color: var(--text-muted); color: var(--text-primary); background: var(--bg-elevated); }
        .btn-accent {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-deep);
        }
        .btn-accent:hover { background: #67d4fc; border-color: #67d4fc; }
        .btn-danger { border-color: var(--danger); color: var(--danger); }
        .btn-danger:hover { background: rgba(248,113,113,0.1); }
        .btn-sm { padding: 6px 10px; font-size: 0.75rem; }
        .btn svg { width: 16px; height: 16px; }

        /* ============ GRID / LIST ============ */
        .content-area {
            max-width: 1600px; margin: 0 auto;
            padding: 0 24px 40px;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
        }
        .image-grid.list-view {
            grid-template-columns: 1fr;
            gap: 8px;
        }

        /* ============ IMAGE CARD ============ */
        .img-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition);
            position: relative;
            opacity: 0;
            animation: fadeUp 0.35s ease forwards;
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .img-card:hover {
            border-color: var(--border-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        .img-card .thumb-wrap {
            position: relative;
            background: var(--bg-elevated);
            height: 180px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
            cursor: pointer;
        }
        .img-card .thumb-wrap img {
            max-width: 92%; max-height: 92%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }
        .img-card:hover .thumb-wrap img { transform: scale(1.05); }
        .img-card .thumb-placeholder {
            color: var(--text-muted);
            font-size: 0.8rem;
            text-align: center;
            padding: 20px;
        }
        .img-card .card-body {
            padding: 14px 16px;
        }
        .img-card .card-title {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
            line-height: 1.3;
        }
        .img-card .card-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .img-card .card-tags {
            display: flex; flex-wrap: wrap; gap: 4px;
            margin-bottom: 10px;
        }
        .img-card .tag {
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--tag-bg);
            border: 1px solid var(--tag-border);
            color: var(--accent);
        }
        .img-card .card-actions {
            display: flex; gap: 6px; align-items: center;
            padding-top: 8px;
            border-top: 1px solid var(--border);
        }
        .img-card .fav-btn {
            position: absolute; top: 10px; right: 10px; z-index: 2;
            width: 32px; height: 32px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            border: none;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all var(--transition);
            color: var(--text-muted);
            font-size: 1rem;
        }
        .img-card .fav-btn:hover { background: rgba(0,0,0,0.7); }
        .img-card .fav-btn.faved { color: var(--accent-warm); }
        .img-card .status-dot {
            position: absolute; top: 10px; left: 10px; z-index: 2;
            width: 10px; height: 10px;
            border-radius: 50%;
            background: var(--text-muted);
        }
        .img-card .status-dot.ok { background: var(--success); }
        .img-card .status-dot.broken { background: var(--danger); }
        .img-card .status-dot.checking {
            background: var(--accent-warm);
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; } 50% { opacity: 0.4; }
        }

        /* ============ LIST VIEW CARDS ============ */
        .list-view .img-card {
            display: flex; flex-direction: row;
        }
        .list-view .thumb-wrap {
            width: 120px; min-width: 120px; height: 80px;
        }
        .list-view .card-body {
            flex: 1; display: flex; align-items: center; gap: 16px;
            padding: 10px 16px;
        }
        .list-view .card-info { flex: 1; }
        .list-view .card-title { margin-bottom: 2px; }
        .list-view .card-tags { margin-bottom: 0; }
        .list-view .card-desc { margin-bottom: 4px; }
        .list-view .card-actions { border-top: none; padding-top: 0; }

        /* ============ MODAL ============ */
        .modal-overlay {
            display: none;
            position: fixed; inset: 0; z-index: 999;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            align-items: center; justify-content: center;
            padding: 24px;
        }
        .modal-overlay.open { display: flex; }
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            max-width: 900px; width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 24px 80px rgba(0,0,0,0.5);
            animation: modalIn 0.25s ease;
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }
        .modal-header h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.3rem;
            font-weight: 400;
        }
        .modal-close {
            width: 36px; height: 36px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem;
            transition: all var(--transition);
        }
        .modal-close:hover { background: var(--bg-hover); color: var(--text-primary); }
        .modal-img-wrap {
            background: var(--bg-elevated);
            display: flex; align-items: center; justify-content: center;
            padding: 24px;
            min-height: 300px;
        }
        .modal-img-wrap img {
            max-width: 100%; max-height: 500px;
            object-fit: contain;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-body .meta-grid {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 8px 16px;
            font-size: 0.85rem;
        }
        .meta-grid .label {
            color: var(--text-muted);
            font-weight: 500;
        }
        .meta-grid .value {
            color: var(--text-primary);
            word-break: break-all;
        }
        .meta-grid .value a {
            color: var(--accent);
            text-decoration: none;
        }
        .meta-grid .value a:hover { text-decoration: underline; }
        .modal-actions {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex; gap: 8px; flex-wrap: wrap;
        }

        /* ============ URL CHECKER PANEL ============ */
        .checker-panel {
            display: none;
            max-width: 1600px; margin: 0 auto;
            padding: 0 24px 20px;
        }
        .checker-panel.open { display: block; }
        .checker-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }
        .checker-box h3 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.1rem;
            margin-bottom: 12px;
            font-weight: 400;
        }
        .checker-progress {
            height: 4px;
            background: var(--bg-elevated);
            border-radius: 2px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .checker-progress .bar {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0;
        }
        .checker-stats {
            display: flex; gap: 20px; font-size: 0.82rem;
        }
        .checker-stats span { color: var(--text-muted); }
        .checker-stats .ok-count { color: var(--success); }
        .checker-stats .fail-count { color: var(--danger); }

        /* ============ EXPORT PANEL ============ */
        .export-panel {
            display: none;
            max-width: 1600px; margin: 0 auto;
            padding: 0 24px 20px;
        }
        .export-panel.open { display: block; }
        .export-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }
        .export-box textarea {
            width: 100%;
            min-height: 200px;
            background: var(--bg-deep);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-family: 'DM Mono', monospace, 'DM Sans';
            font-size: 0.78rem;
            padding: 14px;
            resize: vertical;
        }

        /* ============ TOAST ============ */
        .toast {
            position: fixed;
            bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px);
            background: var(--bg-elevated);
            border: 1px solid var(--border-accent);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: var(--radius);
            font-size: 0.85rem;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ============ EMPTY STATE ============ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-muted);
        }
        .empty-state svg { width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.4; }
        .empty-state p { font-size: 0.9rem; }

        /* ============ PATHOLOGY LINK BADGE ============ */
        .pathology-badge {
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: var(--accent-warm);
        }

        /* ============ SELECTION MODE ============ */
        .img-card.selectable { cursor: pointer; }
        .img-card.selected {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-glow), var(--shadow);
        }
        .img-card .select-check {
            display: none;
            position: absolute; top: 10px; left: 10px; z-index: 3;
            width: 24px; height: 24px;
            border-radius: 50%;
            background: var(--accent);
            color: var(--bg-deep);
            align-items: center; justify-content: center;
            font-size: 0.75rem; font-weight: 700;
        }
        .img-card.selected .select-check { display: flex; }
        .selection-bar {
            display: none;
            position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
            background: var(--bg-elevated);
            border: 1px solid var(--accent);
            border-radius: var(--radius-lg);
            padding: 12px 20px;
            z-index: 500;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            align-items: center; gap: 12px;
            font-size: 0.85rem;
        }
        .selection-bar.show { display: flex; }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 768px) {
            .stats-bar { padding: 12px 16px; }
            .content-area { padding: 0 16px 40px; }
            .image-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }
            .img-card .thumb-wrap { height: 130px; }
            .toolbar { padding: 0 0 10px; }
            .filter-row { padding: 0 0 10px; }
            .header-top { padding: 12px 0 8px; }
            .modal { max-height: 95vh; }
            .modal-img-wrap { min-height: 200px; }
        }
    </style>
</head>
<body>

    <!-- ====== HEADER ====== -->
    <header class="app-header">
        <div class="header-top">
            <div class="logo">
                <span class="logo-mark">MedRef Pro</span>
                <span class="logo-sub">Banque d'images</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-sm" onclick="toggleChecker()" title="V√©rifier les URLs">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
                    V√©rifier
                </button>
                <button class="btn btn-sm" onclick="toggleSelectMode()" id="selectModeBtn" title="Mode s√©lection">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                    S√©lection
                </button>
                <button class="btn btn-sm" onclick="exportData()" title="Exporter">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export
                </button>
            </div>
        </div>

        <div class="toolbar">
            <div class="search-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" id="searchInput" placeholder="Rechercher par nom, description, tag, pathologie‚Ä¶" oninput="applyFilters()">
            </div>
            <button class="btn btn-sm" onclick="filterFavorites()" id="favFilterBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                Favoris
            </button>
            <select id="formatFilter" class="btn btn-sm" onchange="applyFilters()" style="appearance:auto;background:var(--bg-card);">
                <option value="">Tous formats</option>
                <option value="svg">SVG</option>
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="gif">GIF</option>
                <option value="pptx">PPTX</option>
            </select>
            <select id="tagFilter" class="btn btn-sm" onchange="applyFilters()" style="appearance:auto;background:var(--bg-card);">
                <option value="">Tous tags</option>
            </select>
        </div>

        <div class="filter-row" id="categoryChips"></div>
    </header>

    <!-- ====== CHECKER PANEL ====== -->
    <div class="checker-panel" id="checkerPanel">
        <div class="checker-box">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h3>V√©rification des URLs</h3>
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-sm btn-accent" onclick="runUrlCheck()">Lancer</button>
                    <button class="btn btn-sm" onclick="toggleChecker()">Fermer</button>
                </div>
            </div>
            <div class="checker-progress"><div class="bar" id="checkerBar"></div></div>
            <div class="checker-stats">
                <span>V√©rifi√©es : <strong id="checkTotal">0</strong></span>
                <span class="ok-count">‚úì OK : <strong id="checkOk">0</strong></span>
                <span class="fail-count">‚úó Cass√©es : <strong id="checkFail">0</strong></span>
            </div>
        </div>
    </div>

    <!-- ====== EXPORT PANEL ====== -->
    <div class="export-panel" id="exportPanel">
        <div class="export-box">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <h3 style="font-family:'Instrument Serif',serif;font-weight:400;">Export des donn√©es</h3>
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-sm" onclick="copyExport()">Copier</button>
                    <button class="btn btn-sm" onclick="downloadExport()">T√©l√©charger .json</button>
                    <button class="btn btn-sm" onclick="toggleExport()">Fermer</button>
                </div>
            </div>
            <textarea id="exportArea" readonly></textarea>
        </div>
    </div>

    <!-- ====== STATS BAR ====== -->
    <div class="stats-bar">
        <div class="stats-left">
            <div class="stat-item">
                <span class="stat-value" id="totalCount">0</span>
                <span class="stat-label">images</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="catCount">0</span>
                <span class="stat-label">sp√©cialit√©s</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="filteredCount">0</span>
                <span class="stat-label">affich√©es</span>
            </div>
        </div>
        <div class="view-toggles">
            <button class="view-btn active" id="gridViewBtn" onclick="setView('grid')" title="Grille">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
            </button>
            <button class="view-btn" id="listViewBtn" onclick="setView('list')" title="Liste">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
            </button>
        </div>
    </div>

    <!-- ====== CONTENT ====== -->
    <div class="content-area">
        <div class="image-grid" id="imageGrid"></div>
    </div>

    <!-- ====== SELECTION BAR ====== -->
    <div class="selection-bar" id="selectionBar">
        <span id="selCount">0</span> s√©lectionn√©es
        <button class="btn btn-sm btn-accent" onclick="exportSelected()">Exporter s√©lection</button>
        <button class="btn btn-sm" onclick="clearSelection()">Annuler</button>
    </div>

    <!-- ====== MODAL ====== -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalTitle">‚Äî</h2>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-img-wrap">
                <img id="modalImg" src="" alt="">
            </div>
            <div class="modal-body">
                <div class="meta-grid" id="modalMeta"></div>
            </div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>

    <!-- ====== TOAST ====== -->
    <div class="toast" id="toast"></div>

    <script>
    // ============================================================
    // UNIFIED DATABASE ‚Äî Single source of truth
    // ============================================================
    const DB = {
      cardiovasculaire: {
        label: "Cardiovasculaire", icon: "‚ù§Ô∏è",
        pathologies: ["HTA", "Coronaropathie", "Insuffisance cardiaque", "FA", "AVC", "AOMI", "TVP", "Embolie pulmonaire", "Valvulopathie", "P√©ricardite", "An√©vrisme"],
        images: [
          { id:"C01", name:"coeur-anatomie.svg", desc:"Sch√©ma anatomique du c≈ìur", url:"https://upload.wikimedia.org/wikipedia/commons/e/e5/Diagram_of_the_human_heart_%28cropped%29.svg", tags:["anatomie","c≈ìur"], pathologies:["Insuffisance cardiaque","Valvulopathie"] },
          { id:"C02", name:"coeur-coupe.png", desc:"Coupe transversale du c≈ìur", url:"https://upload.wikimedia.org/wikipedia/commons/d/d9/Blausen_0457_Heart_SectionalAnatomy.png", tags:["anatomie","c≈ìur","coupe"], pathologies:["Insuffisance cardiaque"] },
          { id:"C03", name:"coeur-anterieur.png", desc:"Vue ant√©rieure du c≈ìur", url:"https://upload.wikimedia.org/wikipedia/commons/d/d4/Blausen_0451_Heart_Anterior.png", tags:["anatomie","c≈ìur"], pathologies:[] },
          { id:"C04", name:"valves-cardiaques.png", desc:"Anatomie des valves cardiaques", url:"https://upload.wikimedia.org/wikipedia/commons/3/3a/Blausen_0470_HeartValves_Anatomy.png", tags:["anatomie","valves"], pathologies:["Valvulopathie"] },
          { id:"C05", name:"circulation-cardiaque.svg", desc:"Circulation sanguine cardiaque", url:"https://upload.wikimedia.org/wikipedia/commons/2/22/Heart_diagram_blood_flow_en.svg", tags:["physiologie","circulation"], pathologies:[] },
          { id:"C06", name:"conduction-cardiaque.png", desc:"Syst√®me de conduction cardiaque", url:"https://upload.wikimedia.org/wikipedia/commons/5/5a/Cardiac_Conduction_System.png", tags:["physiologie","conduction","ECG"], pathologies:["FA"] },
          { id:"C07", name:"hvg-hypertrophie.png", desc:"Hypertrophie ventriculaire gauche", url:"https://upload.wikimedia.org/wikipedia/commons/a/a5/Blausen_0455_Heart_LeftVentricleHypertrophy.png", tags:["pathologie","hypertrophie"], pathologies:["HTA","Insuffisance cardiaque"] },
          { id:"C08", name:"arteres-coronaires.svg", desc:"Art√®res coronaires", url:"https://upload.wikimedia.org/wikipedia/commons/1/15/Coronary_arteries.svg", tags:["anatomie","coronaires"], pathologies:["Coronaropathie"] },
          { id:"C09", name:"atherosclerose.png", desc:"Ath√©roscl√©rose art√©rielle", url:"https://upload.wikimedia.org/wikipedia/commons/b/b7/Blausen_0052_Artery_NormalvPartiallyBlocked.png", tags:["physiopathologie","ath√©roscl√©rose"], pathologies:["Coronaropathie","AOMI"] },
          { id:"C10", name:"coronaropathie.png", desc:"Coronaropathie", url:"https://upload.wikimedia.org/wikipedia/commons/6/6e/Blausen_0260_Coronary_Artery_Disease_02.png", tags:["pathologie","coronaires"], pathologies:["Coronaropathie"] },
          { id:"C11", name:"infarctus.png", desc:"Infarctus du myocarde", url:"https://upload.wikimedia.org/wikipedia/commons/1/1e/Blausen_0463_HeartAttack.png", tags:["pathologie","IDM","urgence"], pathologies:["Coronaropathie"] },
          { id:"C12", name:"atherosclerose-formation.svg", desc:"Formation de la plaque d'ath√©rome", url:"https://upload.wikimedia.org/wikipedia/commons/a/a0/Endo_dysfunction_Athero-fr.svg", tags:["physiopathologie","ath√©roscl√©rose","plaque"], pathologies:["Coronaropathie","AOMI"] },
          { id:"C13", name:"hta-complications.svg", desc:"Complications de l'HTA", url:"https://upload.wikimedia.org/wikipedia/commons/8/8e/Main_complications_of_persistent_high_blood_pressure.svg", tags:["pathologie","HTA","complications"], pathologies:["HTA"] },
          { id:"C14", name:"hypertension.png", desc:"Hypertension art√©rielle", url:"https://upload.wikimedia.org/wikipedia/commons/f/f5/Blausen_0486_HighBloodPressure_01.png", tags:["pathologie","HTA"], pathologies:["HTA"] },
          { id:"C15", name:"cardiomyopathie-dilatee.svg", desc:"Cardiomyopathie dilat√©e", url:"https://upload.wikimedia.org/wikipedia/commons/5/5d/Blausen_0165_Cardiomyopathy_Dilated.svg", tags:["pathologie","cardiomyopathie"], pathologies:["Insuffisance cardiaque"] },
          { id:"C16", name:"cardiomyopathie-hypertrophique.svg", desc:"Cardiomyopathie hypertrophique", url:"https://upload.wikimedia.org/wikipedia/commons/a/a8/Blausen_0166_Cardiomyopathy_Hypertrophic.svg", tags:["pathologie","cardiomyopathie","CMH"], pathologies:["Insuffisance cardiaque"] },
          { id:"C17", name:"ecg-normal.svg", desc:"ECG rythme sinusal normal", url:"https://upload.wikimedia.org/wikipedia/commons/9/9e/SinusRhythmLabels.svg", tags:["diagnostic","ECG","sinusal"], pathologies:["FA"] },
          { id:"C18", name:"fa-ecg.jpg", desc:"ECG fibrillation atriale", url:"https://upload.wikimedia.org/wikipedia/commons/b/bd/Afib_ecg.jpg", tags:["diagnostic","ECG","FA"], pathologies:["FA"] },
          { id:"C19", name:"fa-schema.svg", desc:"Sch√©ma fibrillation atriale", url:"https://upload.wikimedia.org/wikipedia/commons/f/f0/Atrial_Fibrillation.svg", tags:["physiopathologie","FA","arythmie"], pathologies:["FA"] },
          { id:"C20", name:"fv-ecg.svg", desc:"ECG fibrillation ventriculaire", url:"https://upload.wikimedia.org/wikipedia/commons/1/1e/Ventricular_Fibrillation.svg", tags:["diagnostic","ECG","urgence"], pathologies:[] },
          { id:"C21", name:"tv-ecg.svg", desc:"ECG tachycardie ventriculaire", url:"https://upload.wikimedia.org/wikipedia/commons/8/87/Ventricular_Tachycardia.svg", tags:["diagnostic","ECG","urgence"], pathologies:[] },
          { id:"C22", name:"bradycardie-ecg.svg", desc:"ECG bradycardie sinusale", url:"https://upload.wikimedia.org/wikipedia/commons/d/d7/Sinus_Bradycardia.svg", tags:["diagnostic","ECG"], pathologies:[] },
          { id:"C23", name:"tachycardie-ecg.svg", desc:"ECG tachycardie sinusale", url:"https://upload.wikimedia.org/wikipedia/commons/4/4d/Sinus_Tachycardia.svg", tags:["diagnostic","ECG"], pathologies:[] },
          { id:"C24", name:"potentiel-action-cardiaque.svg", desc:"Potentiel d'action cardiomyocyte", url:"https://upload.wikimedia.org/wikipedia/commons/a/a2/Action_potential_ventr_myocyte.svg", tags:["physiologie","√©lectrophysiologie"], pathologies:[] },
          { id:"C25", name:"wiggers-diagram.svg", desc:"Diagramme de Wiggers", url:"https://upload.wikimedia.org/wikipedia/commons/1/11/Wiggers_Diagram.svg", tags:["physiologie","cycle cardiaque"], pathologies:[] },
          { id:"C26", name:"cycle-cardiaque.jpg", desc:"Cycle cardiaque complet", url:"https://upload.wikimedia.org/wikipedia/commons/4/4c/2029_Cardiac_Cycle.jpg", tags:["physiologie","cycle cardiaque"], pathologies:[] },
          { id:"C27", name:"coeur-diastole.svg", desc:"C≈ìur en diastole", url:"https://upload.wikimedia.org/wikipedia/commons/5/56/Heart_diastole.svg", tags:["physiologie","diastole"], pathologies:[] },
          { id:"C28", name:"coeur-systole.svg", desc:"C≈ìur en systole", url:"https://upload.wikimedia.org/wikipedia/commons/f/f3/Heart_systole.svg", tags:["physiologie","systole"], pathologies:[] },
          { id:"C29", name:"frank-starling.svg", desc:"Courbes de Frank-Starling", url:"https://upload.wikimedia.org/wikipedia/commons/f/f5/Frank-Starling_curves_with_labels.svg", tags:["physiologie","Frank-Starling"], pathologies:["Insuffisance cardiaque"] },
          { id:"C30", name:"preload-afterload.svg", desc:"Pr√©charge et postcharge", url:"https://upload.wikimedia.org/wikipedia/commons/4/4e/Preload_afterload_stroke_volume.svg", tags:["physiologie","h√©modynamique"], pathologies:["Insuffisance cardiaque"] },
          { id:"C31", name:"embolie-pulmonaire.png", desc:"Embolie pulmonaire", url:"https://upload.wikimedia.org/wikipedia/commons/c/c9/Blausen_0742_PulmonaryEmbolism.png", tags:["pathologie","EP","urgence"], pathologies:["Embolie pulmonaire"] },
          { id:"C32", name:"tvp-jambe.jpg", desc:"Thrombose veineuse profonde", url:"https://upload.wikimedia.org/wikipedia/commons/c/c8/Deep_vein_thrombosis_of_the_right_leg.jpg", tags:["pathologie","TVP","thrombose"], pathologies:["TVP"] },
          { id:"C33", name:"aomi.svg", desc:"Art√©riopathie oblit√©rante", url:"https://upload.wikimedia.org/wikipedia/commons/d/d9/Blausen_Peripheral_Arterial_Disease_eng.svg", tags:["pathologie","AOMI","art√®res"], pathologies:["AOMI"] },
          { id:"C34", name:"sraa-systeme.png", desc:"Syst√®me r√©nine-angiotensine", url:"https://upload.wikimedia.org/wikipedia/commons/c/c8/Blausen_0699_RAAS_Overview.png", tags:["physiologie","SRAA","r√©nine"], pathologies:["HTA","Insuffisance cardiaque"] },
          { id:"C35", name:"raas-schema.png", desc:"Sch√©ma SRAA d√©taill√©", url:"https://upload.wikimedia.org/wikipedia/commons/5/5a/Renin-angiotensin-aldosterone_system.png", tags:["physiologie","SRAA"], pathologies:["HTA"] },
          { id:"C36", name:"circulation-systemique.svg", desc:"Circulation syst√©mique", url:"https://upload.wikimedia.org/wikipedia/commons/2/23/Circulatory_System_en.svg", tags:["anatomie","circulation"], pathologies:[] },
          { id:"C37", name:"flux-sanguin-coeur.jpg", desc:"Flux sanguin √† travers le c≈ìur", url:"https://upload.wikimedia.org/wikipedia/commons/5/57/2101_Blood_Flow_Through_the_Heart.jpg", tags:["physiologie","circulation"], pathologies:[] },
          { id:"C38", name:"cha2ds2-vasc.svg", desc:"Score CHA2DS2-VASc", url:"https://upload.wikimedia.org/wikipedia/commons/a/a3/CHA2DS2-VASc_score.svg", tags:["diagnostic","score","FA"], pathologies:["FA","AVC"] },
          { id:"C39", name:"insuffisance-aortique.png", desc:"Insuffisance aortique", url:"https://upload.wikimedia.org/wikipedia/commons/a/a4/Blausen_0039_AorticRegurgitation.png", tags:["pathologie","valvulopathie","IAo"], pathologies:["Valvulopathie"] },
          { id:"C40", name:"stenose-aortique.png", desc:"St√©nose aortique", url:"https://upload.wikimedia.org/wikipedia/commons/8/8c/Blausen_0040_AorticStenosis.png", tags:["pathologie","valvulopathie","RAo"], pathologies:["Valvulopathie"] },
          { id:"C41", name:"insuffisance-mitrale.png", desc:"Insuffisance mitrale", url:"https://upload.wikimedia.org/wikipedia/commons/4/4a/Blausen_0631_MitralRegurgitation.png", tags:["pathologie","valvulopathie","IM"], pathologies:["Valvulopathie"] },
          { id:"C42", name:"stenose-mitrale.png", desc:"St√©nose mitrale", url:"https://upload.wikimedia.org/wikipedia/commons/5/54/Blausen_0632_MitralStenosis.png", tags:["pathologie","valvulopathie","RM"], pathologies:["Valvulopathie"] },
          { id:"C43", name:"epanchement-pericardique.png", desc:"√âpanchement p√©ricardique", url:"https://upload.wikimedia.org/wikipedia/commons/3/3c/Blausen_0724_PericardialEffusion.png", tags:["pathologie","p√©ricarde"], pathologies:["P√©ricardite"] },
          { id:"C44", name:"pericardite.png", desc:"P√©ricardite", url:"https://upload.wikimedia.org/wikipedia/commons/8/83/Blausen_0725_Pericarditis.png", tags:["pathologie","p√©ricarde"], pathologies:["P√©ricardite"] },
          { id:"C45", name:"anevrisme-aorte.png", desc:"An√©vrisme de l'aorte abdominale", url:"https://upload.wikimedia.org/wikipedia/commons/e/e5/Blausen_0001_AbdominalAorticAneurysm.png", tags:["pathologie","an√©vrisme","aorte"], pathologies:["An√©vrisme"] },
        ]
      },
      neurologie: {
        label: "Neurologie", icon: "üß†",
        pathologies: ["AVC", "Alzheimer", "Parkinson", "√âpilepsie", "Migraine", "M√©ningite", "SEP"],
        images: [
          { id:"N01", name:"cerveau-lateral.png", desc:"Cerveau vue lat√©rale", url:"https://upload.wikimedia.org/wikipedia/commons/d/d2/Blausen_0101_Brain_LateralView.png", tags:["anatomie","cerveau"], pathologies:[] },
          { id:"N02", name:"cerveau-lobes.png", desc:"Lobes c√©r√©braux", url:"https://upload.wikimedia.org/wikipedia/commons/0/09/Blausen_0111_BrainLobes.png", tags:["anatomie","cerveau","lobes"], pathologies:[] },
          { id:"N03", name:"cerveau-coupe.png", desc:"Coupe du cerveau", url:"https://upload.wikimedia.org/wikipedia/commons/1/10/Blausen_0170_Cerebrum.png", tags:["anatomie","cerveau","coupe"], pathologies:[] },
          { id:"N04", name:"cerveau-sagittal.png", desc:"Coupe sagittale cerveau", url:"https://upload.wikimedia.org/wikipedia/commons/e/ea/Blausen_0114_BrainSagittal.png", tags:["anatomie","cerveau"], pathologies:[] },
          { id:"N05", name:"tronc-cerebral.png", desc:"Tronc c√©r√©bral", url:"https://upload.wikimedia.org/wikipedia/commons/4/4a/Blausen_0115_BrainStem.png", tags:["anatomie","tronc c√©r√©bral"], pathologies:[] },
          { id:"N06", name:"polygone-willis.svg", desc:"Polygone de Willis", url:"https://upload.wikimedia.org/wikipedia/commons/2/2e/Circle_of_Willis_en.svg", tags:["anatomie","vascularisation","Willis"], pathologies:["AVC"] },
          { id:"N07", name:"arteres-cerebrales.png", desc:"Art√®res c√©r√©brales", url:"https://upload.wikimedia.org/wikipedia/commons/9/9a/Gray516.png", tags:["anatomie","vascularisation"], pathologies:["AVC"] },
          { id:"N08", name:"avc.png", desc:"Accident vasculaire c√©r√©bral", url:"https://upload.wikimedia.org/wikipedia/commons/6/64/Blausen_0836_Stroke.png", tags:["pathologie","AVC","urgence"], pathologies:["AVC"] },
          { id:"N09", name:"avc-ischemique.svg", desc:"AVC isch√©mique", url:"https://upload.wikimedia.org/wikipedia/commons/7/75/Ischemic_Stroke.svg", tags:["pathologie","AVC","isch√©mie"], pathologies:["AVC"] },
          { id:"N10", name:"hemorragie-cerebrale-types.png", desc:"Types d'h√©morragies c√©r√©brales", url:"https://upload.wikimedia.org/wikipedia/commons/8/8c/An_illustration_of_the_different_types_of_brain_hemorrhage.png", tags:["pathologie","h√©morragie","AVC"], pathologies:["AVC"] },
          { id:"N11", name:"neurone.png", desc:"Neurone multipolaire", url:"https://upload.wikimedia.org/wikipedia/commons/b/b5/Blausen_0657_MultipolarNeuron.png", tags:["histologie","neurone"], pathologies:[] },
          { id:"N12", name:"synapse.png", desc:"Synapse", url:"https://upload.wikimedia.org/wikipedia/commons/a/a6/Blausen_0803_Synapse.png", tags:["histologie","synapse"], pathologies:["Alzheimer","Parkinson"] },
          { id:"N13", name:"synapse-chimique.jpg", desc:"Synapse chimique d√©taill√©e", url:"https://upload.wikimedia.org/wikipedia/commons/4/4a/Chemical_synapse_schema_cropped.jpg", tags:["histologie","synapse","neurotransmetteurs"], pathologies:[] },
          { id:"N14", name:"potentiel-action.gif", desc:"Potentiel d'action neuronal", url:"https://upload.wikimedia.org/wikipedia/commons/9/95/Action_Potential.gif", tags:["physiologie","potentiel d'action"], pathologies:["√âpilepsie"] },
          { id:"N15", name:"moelle-epiniere.png", desc:"Moelle √©pini√®re", url:"https://upload.wikimedia.org/wikipedia/commons/f/f8/Blausen_0822_SpinalCord.png", tags:["anatomie","moelle √©pini√®re"], pathologies:[] },
          { id:"N16", name:"moelle-coupe.svg", desc:"Coupe transversale moelle", url:"https://upload.wikimedia.org/wikipedia/commons/d/dc/Spinal_cord_cross_section.svg", tags:["anatomie","moelle √©pini√®re","coupe"], pathologies:["SEP"] },
          { id:"N17", name:"systeme-nerveux.jpg", desc:"Vue d'ensemble syst√®me nerveux", url:"https://upload.wikimedia.org/wikipedia/commons/b/ba/1201_Overview_of_Nervous_System.jpg", tags:["anatomie","syst√®me nerveux"], pathologies:[] },
          { id:"N18", name:"alzheimer-cerveau.jpg", desc:"Cerveau Alzheimer vs normal", url:"https://upload.wikimedia.org/wikipedia/commons/a/a5/Alzheimer%27s_disease_brain_comparison.jpg", tags:["pathologie","Alzheimer","atrophie"], pathologies:["Alzheimer"] },
          { id:"N19", name:"parkinson.png", desc:"Maladie de Parkinson", url:"https://upload.wikimedia.org/wikipedia/commons/3/35/Blausen_0704_ParkinsonsDisease.png", tags:["pathologie","Parkinson","dopamine"], pathologies:["Parkinson"] },
          { id:"N20", name:"migraine.png", desc:"Migraine", url:"https://upload.wikimedia.org/wikipedia/commons/9/9f/Blausen_0649_Migraine.png", tags:["pathologie","migraine","c√©phal√©e"], pathologies:["Migraine"] },
          { id:"N21", name:"epilepsie.png", desc:"√âpilepsie", url:"https://upload.wikimedia.org/wikipedia/commons/4/47/Blausen_0333_Epilepsy.png", tags:["pathologie","√©pilepsie","convulsions"], pathologies:["√âpilepsie"] },
          { id:"N22", name:"meningite.png", desc:"M√©ningite", url:"https://upload.wikimedia.org/wikipedia/commons/8/85/Blausen_0631_Meningitis.png", tags:["pathologie","m√©ningite","infection"], pathologies:["M√©ningite"] },
          { id:"N23", name:"meninges.svg", desc:"M√©ninges", url:"https://upload.wikimedia.org/wikipedia/commons/8/8e/Meninges-en.svg", tags:["anatomie","m√©ninges"], pathologies:["M√©ningite"] },
          { id:"N24", name:"dermatomes-posterieur.svg", desc:"Dermatomes face post√©rieure", url:"https://upload.wikimedia.org/wikipedia/commons/8/8f/Dermatomes_and_cutaneous_nerves_-_posterior.svg", tags:["anatomie","dermatomes","neurologie"], pathologies:[] },
          { id:"N25", name:"dermatomes-anterieur.svg", desc:"Dermatomes face ant√©rieure", url:"https://upload.wikimedia.org/wikipedia/commons/c/cf/Dermatomes_and_cutaneous_nerves_-_anterior.svg", tags:["anatomie","dermatomes","neurologie"], pathologies:[] },
          { id:"N26", name:"ventricules-cerebraux.png", desc:"Ventricules c√©r√©braux", url:"https://upload.wikimedia.org/wikipedia/commons/d/d4/Blausen_0896_Ventricles_Brain.png", tags:["anatomie","ventricules","LCR"], pathologies:[] },
          { id:"N27", name:"systeme-limbique.png", desc:"Syst√®me limbique", url:"https://upload.wikimedia.org/wikipedia/commons/5/5e/Blausen_0614_LimbicSystem.png", tags:["anatomie","limbique","√©motions"], pathologies:["Alzheimer"] },
          { id:"N28", name:"barriere-hemato-encephalique.png", desc:"Barri√®re h√©mato-enc√©phalique", url:"https://upload.wikimedia.org/wikipedia/commons/4/46/Blausen_0104_BloodBrainBarrier.png", tags:["physiologie","BHE"], pathologies:["M√©ningite","SEP"] },
          { id:"N29", name:"nerfs-craniens.svg", desc:"Nerfs cr√¢niens", url:"https://upload.wikimedia.org/wikipedia/commons/2/20/Brain_human_normal_inferior_view_with_labels_en.svg", tags:["anatomie","nerfs cr√¢niens"], pathologies:[] },
        ]
      },
      respiratoire: {
        label: "Respiratoire", icon: "ü´Å",
        pathologies: ["Asthme", "BPCO", "Pneumonie", "Pneumothorax", "Embolie pulmonaire", "SDRA", "Cancer poumon", "Tuberculose"],
        images: [
          { id:"R01", name:"systeme-respiratoire.png", desc:"Syst√®me respiratoire complet", url:"https://upload.wikimedia.org/wikipedia/commons/d/db/Blausen_0770_RespiratorySystem_02.png", tags:["anatomie","poumons"], pathologies:[] },
          { id:"R02", name:"poumons.png", desc:"Poumons", url:"https://upload.wikimedia.org/wikipedia/commons/a/a9/Blausen_0620_Lungs_Background.png", tags:["anatomie","poumons"], pathologies:[] },
          { id:"R03", name:"bronches.png", desc:"Bronches", url:"https://upload.wikimedia.org/wikipedia/commons/b/b6/Blausen_0165_Bronchiole.png", tags:["anatomie","bronches"], pathologies:["Asthme","BPCO"] },
          { id:"R04", name:"bronchioles.png", desc:"Bronchioles", url:"https://upload.wikimedia.org/wikipedia/commons/4/4d/Blausen_0168_Bronchioles.png", tags:["anatomie","bronchioles"], pathologies:["Asthme"] },
          { id:"R05", name:"alveoles.png", desc:"Alv√©oles pulmonaires", url:"https://upload.wikimedia.org/wikipedia/commons/f/f9/Blausen_0016_Alveolus.png", tags:["anatomie","alv√©oles"], pathologies:["Pneumonie","SDRA"] },
          { id:"R06", name:"arbre-bronchique.png", desc:"Arbre bronchique", url:"https://upload.wikimedia.org/wikipedia/commons/9/9f/Blausen_0014_Airways.png", tags:["anatomie","bronches"], pathologies:[] },
          { id:"R07", name:"voies-respiratoires.png", desc:"Voies respiratoires", url:"https://upload.wikimedia.org/wikipedia/commons/0/08/Blausen_0767_RespiratoryRoutes.png", tags:["anatomie","voies a√©riennes"], pathologies:[] },
          { id:"R08", name:"asthme-attaque.jpg", desc:"Crise d'asthme", url:"https://upload.wikimedia.org/wikipedia/commons/8/8b/Asthma_attack-illustration_NIH.jpg", tags:["pathologie","asthme","bronchospasme"], pathologies:["Asthme"] },
          { id:"R09", name:"bpco.jpg", desc:"BPCO", url:"https://upload.wikimedia.org/wikipedia/commons/3/31/Copd_2010.jpg", tags:["pathologie","BPCO","emphys√®me"], pathologies:["BPCO"] },
          { id:"R10", name:"pneumothorax.png", desc:"Pneumothorax", url:"https://upload.wikimedia.org/wikipedia/commons/a/a2/Blausen_0742_Pneumothorax.png", tags:["pathologie","pneumothorax","urgence"], pathologies:["Pneumothorax"] },
          { id:"R11", name:"pneumonie.png", desc:"Pneumonie", url:"https://upload.wikimedia.org/wikipedia/commons/a/ab/Blausen_0706_Pneumonia.png", tags:["pathologie","pneumonie","infection"], pathologies:["Pneumonie"] },
          { id:"R12", name:"sdra.png", desc:"SDRA", url:"https://upload.wikimedia.org/wikipedia/commons/2/2c/Blausen_0620_ARDS.png", tags:["pathologie","SDRA","r√©animation"], pathologies:["SDRA"] },
          { id:"R13", name:"alveole-schema.svg", desc:"Sch√©ma alv√©ole", url:"https://upload.wikimedia.org/wikipedia/commons/4/4b/Alveolus_diagram.svg", tags:["physiologie","alv√©oles","√©changes gazeux"], pathologies:[] },
          { id:"R14", name:"echanges-gazeux.svg", desc:"√âchanges gazeux alv√©olaires", url:"https://upload.wikimedia.org/wikipedia/commons/0/0b/Gas_exchange_in_the_aveolus.svg", tags:["physiologie","√©changes gazeux","O2","CO2"], pathologies:["SDRA"] },
          { id:"R15", name:"respiration-diaphragme.gif", desc:"Respiration diaphragmatique", url:"https://upload.wikimedia.org/wikipedia/commons/e/e4/Diaphragm_breathing.gif", tags:["physiologie","diaphragme","m√©canique"], pathologies:[] },
          { id:"R16", name:"spirometrie.jpg", desc:"Spirom√©trie", url:"https://upload.wikimedia.org/wikipedia/commons/b/b4/Spirometry_NIH.jpg", tags:["diagnostic","spirom√©trie","EFR"], pathologies:["Asthme","BPCO"] },
          { id:"R17", name:"volumes-pulmonaires.svg", desc:"Volumes pulmonaires", url:"https://upload.wikimedia.org/wikipedia/commons/3/3b/Lungvolumes.svg", tags:["physiologie","volumes","EFR"], pathologies:["BPCO"] },
          { id:"R18", name:"cavite-pleurale.png", desc:"Cavit√© pleurale", url:"https://upload.wikimedia.org/wikipedia/commons/2/2f/Blausen_0607_Lungs_PleuralCavity.png", tags:["anatomie","pl√®vre"], pathologies:["Pneumothorax"] },
          { id:"R19", name:"diaphragme.png", desc:"Position du diaphragme", url:"https://upload.wikimedia.org/wikipedia/commons/d/d7/Blausen_0313_DiaphragmPosition.png", tags:["anatomie","diaphragme"], pathologies:[] },
          { id:"R20", name:"cancer-poumon.png", desc:"Cancer du poumon", url:"https://upload.wikimedia.org/wikipedia/commons/f/f1/Blausen_0620_LungCancer.png", tags:["pathologie","cancer","poumon"], pathologies:["Cancer poumon"] },
          { id:"R21", name:"tuberculose-radio.jpg", desc:"Radiographie tuberculose", url:"https://upload.wikimedia.org/wikipedia/commons/5/5d/Tuberculosis-x-ray-1.jpg", tags:["diagnostic","radiographie","tuberculose"], pathologies:["Tuberculose"] },
          { id:"R22", name:"courbe-dissociation-hb.png", desc:"Courbe de dissociation Hb-O2", url:"https://upload.wikimedia.org/wikipedia/commons/8/8a/Oxy-hemoglobin_dissociation_curve.png", tags:["physiologie","h√©moglobine","O2"], pathologies:[] },
          { id:"R23", name:"muscles-respiratoires.png", desc:"Muscles de la respiration", url:"https://upload.wikimedia.org/wikipedia/commons/9/95/Blausen_0615_MusclesofRespiration.png", tags:["anatomie","muscles","respiration"], pathologies:[] },
          { id:"R24", name:"trachee.png", desc:"Anatomie trach√©e", url:"https://upload.wikimedia.org/wikipedia/commons/7/7f/Blausen_0862_TracheaAnatomy.png", tags:["anatomie","trach√©e"], pathologies:[] },
        ]
      },
      digestif: {
        label: "Digestif", icon: "üî¨",
        pathologies: ["RGO", "Ulc√®re", "Cirrhose", "H√©patite", "Appendicite", "Chol√©cystite", "Pancr√©atite", "Crohn", "RCH", "Cancer colorectal"],
        images: [
          { id:"D01", name:"systeme-digestif.png", desc:"Syst√®me digestif complet", url:"https://upload.wikimedia.org/wikipedia/commons/c/c5/Blausen_0316_DigestiveSystem.png", tags:["anatomie","digestif"], pathologies:[] },
          { id:"D02", name:"intestin-grele.png", desc:"Intestin gr√™le anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/9/90/Blausen_0817_SmallIntestine_Anatomy.png", tags:["anatomie","intestin gr√™le"], pathologies:["Crohn"] },
          { id:"D03", name:"colon.png", desc:"C√¥lon anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/4/42/Blausen_0603_LargeIntestine_Anatomy.png", tags:["anatomie","c√¥lon"], pathologies:["RCH","Cancer colorectal"] },
          { id:"D04", name:"estomac.png", desc:"Anatomie estomac", url:"https://upload.wikimedia.org/wikipedia/commons/b/b5/Blausen_0817_Stomach_Anatomy.png", tags:["anatomie","estomac"], pathologies:["Ulc√®re","RGO"] },
          { id:"D05", name:"foie-pancreas.png", desc:"Foie et pancr√©as position", url:"https://upload.wikimedia.org/wikipedia/commons/9/94/Blausen_0428_Gallbladder-Liver-Pancreas_Location.png", tags:["anatomie","foie","pancr√©as"], pathologies:[] },
          { id:"D06", name:"foie.png", desc:"Foie anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/2/21/Blausen_0613_Liver.png", tags:["anatomie","foie"], pathologies:["Cirrhose","H√©patite"] },
          { id:"D07", name:"vesicule-biliaire.png", desc:"V√©sicule biliaire", url:"https://upload.wikimedia.org/wikipedia/commons/a/a6/Blausen_0425_GallbladderAnatomy.png", tags:["anatomie","v√©sicule"], pathologies:["Chol√©cystite"] },
          { id:"D08", name:"pancreas.png", desc:"Pancr√©as anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/6/64/Blausen_0701_PancreasAnatomy2.png", tags:["anatomie","pancr√©as"], pathologies:["Pancr√©atite"] },
          { id:"D09", name:"oesophage.png", desc:"≈ísophage", url:"https://upload.wikimedia.org/wikipedia/commons/e/e5/Blausen_0346_Esophagus.png", tags:["anatomie","≈ìsophage"], pathologies:["RGO"] },
          { id:"D10", name:"rgo.png", desc:"Reflux gastro-≈ìsophagien", url:"https://upload.wikimedia.org/wikipedia/commons/4/4e/Blausen_0432_GastroesophagealReflux.png", tags:["pathologie","RGO","reflux"], pathologies:["RGO"] },
          { id:"D11", name:"ulcere-gastrique.png", desc:"Ulc√®re gastrique", url:"https://upload.wikimedia.org/wikipedia/commons/e/ef/Blausen_0439_GastricUlcer.png", tags:["pathologie","ulc√®re","estomac"], pathologies:["Ulc√®re"] },
          { id:"D12", name:"cirrhose.png", desc:"Cirrhose h√©patique", url:"https://upload.wikimedia.org/wikipedia/commons/5/5a/Blausen_0173_Cirrhosis.png", tags:["pathologie","cirrhose","foie"], pathologies:["Cirrhose"] },
          { id:"D13", name:"hepatite.png", desc:"H√©patite", url:"https://upload.wikimedia.org/wikipedia/commons/e/e4/Blausen_0455_Hepatitis.png", tags:["pathologie","h√©patite","foie"], pathologies:["H√©patite"] },
          { id:"D14", name:"appendicite.png", desc:"Appendicite", url:"https://upload.wikimedia.org/wikipedia/commons/a/a8/Blausen_0006_Appendicitis.png", tags:["pathologie","appendicite","urgence"], pathologies:["Appendicite"] },
          { id:"D15", name:"cholecystite.png", desc:"Chol√©cystite", url:"https://upload.wikimedia.org/wikipedia/commons/1/17/Blausen_0216_Cholecystitis.png", tags:["pathologie","chol√©cystite","v√©sicule"], pathologies:["Chol√©cystite"] },
          { id:"D16", name:"pancreatite.png", desc:"Pancr√©atite", url:"https://upload.wikimedia.org/wikipedia/commons/c/c5/Blausen_0696_Pancreatitis.png", tags:["pathologie","pancr√©atite"], pathologies:["Pancr√©atite"] },
          { id:"D17", name:"crohn.png", desc:"Maladie de Crohn", url:"https://upload.wikimedia.org/wikipedia/commons/a/ae/Blausen_0286_CrohnsDisease.png", tags:["pathologie","Crohn","MICI"], pathologies:["Crohn"] },
          { id:"D18", name:"rch.png", desc:"Rectocolite h√©morragique", url:"https://upload.wikimedia.org/wikipedia/commons/8/8e/Blausen_0879_UlcerativeColitis.png", tags:["pathologie","RCH","MICI"], pathologies:["RCH"] },
          { id:"D19", name:"cancer-colorectal.png", desc:"Cancer colorectal", url:"https://upload.wikimedia.org/wikipedia/commons/4/49/Blausen_0189_ColorectalCancer.png", tags:["pathologie","cancer","c√¥lon"], pathologies:["Cancer colorectal"] },
          { id:"D20", name:"hemorroides.png", desc:"H√©morro√Ødes anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/6/6b/Blausen_0449_HemorrhoidAnatomy.png", tags:["pathologie","h√©morro√Ødes"], pathologies:[] },
          { id:"D21", name:"hernie-hiatale.png", desc:"Hernie hiatale", url:"https://upload.wikimedia.org/wikipedia/commons/2/2b/Blausen_0459_HerniatedDiaphragm.png", tags:["pathologie","hernie","diaphragme"], pathologies:["RGO"] },
          { id:"D22", name:"hernie-inguinale.png", desc:"Hernie inguinale", url:"https://upload.wikimedia.org/wikipedia/commons/c/cc/Blausen_0472_InguinalHernia.png", tags:["pathologie","hernie"], pathologies:[] },
          { id:"D23", name:"calculs-biliaires.png", desc:"Calculs biliaires", url:"https://upload.wikimedia.org/wikipedia/commons/6/66/Blausen_0433_GallstonesinBileDuct.png", tags:["pathologie","calculs","voies biliaires"], pathologies:["Chol√©cystite"] },
        ]
      },
      metabolique: {
        label: "M√©tabolique", icon: "‚öóÔ∏è",
        pathologies: ["Diab√®te type 1", "Diab√®te type 2", "Hypothyro√Ødie", "Hyperthyro√Ødie", "Ob√©sit√©"],
        images: [
          { id:"M01", name:"diabete.png", desc:"Diab√®te vue d'ensemble", url:"https://upload.wikimedia.org/wikipedia/commons/c/c2/Blausen_0314_Diabetes_Overview.png", tags:["pathologie","diab√®te"], pathologies:["Diab√®te type 1","Diab√®te type 2"] },
          { id:"M02", name:"diabete-type1.png", desc:"Diab√®te type 1", url:"https://upload.wikimedia.org/wikipedia/commons/2/27/Blausen_0312_Diabetes_Type1.png", tags:["pathologie","diab√®te","auto-immun"], pathologies:["Diab√®te type 1"] },
          { id:"M03", name:"diabete-type2.png", desc:"Diab√®te type 2", url:"https://upload.wikimedia.org/wikipedia/commons/9/90/Blausen_0313_Diabetes_Type2.png", tags:["pathologie","diab√®te","insulinor√©sistance"], pathologies:["Diab√®te type 2"] },
          { id:"M04", name:"insuline-glucose.svg", desc:"M√©tabolisme insuline-glucose", url:"https://upload.wikimedia.org/wikipedia/commons/d/dc/Insulin_glucose_metabolism_ZP.svg", tags:["physiologie","insuline","glucose"], pathologies:["Diab√®te type 1","Diab√®te type 2"] },
          { id:"M05", name:"thyroide.png", desc:"Thyro√Øde", url:"https://upload.wikimedia.org/wikipedia/commons/c/c4/Blausen_0846_Thyroid.png", tags:["anatomie","thyro√Øde"], pathologies:["Hypothyro√Ødie","Hyperthyro√Ødie"] },
          { id:"M06", name:"goitre.png", desc:"Goitre thyro√Ødien", url:"https://upload.wikimedia.org/wikipedia/commons/3/3e/Blausen_0534_Goiter.png", tags:["pathologie","goitre","thyro√Øde"], pathologies:["Hypothyro√Ødie","Hyperthyro√Ødie"] },
          { id:"M07", name:"surrenales.png", desc:"Glandes surr√©nales", url:"https://upload.wikimedia.org/wikipedia/commons/5/52/Blausen_0015_AdrenalGlands.png", tags:["anatomie","surr√©nales","cortisol"], pathologies:[] },
          { id:"M08", name:"ilots-langerhans.png", desc:"√élots de Langerhans", url:"https://upload.wikimedia.org/wikipedia/commons/2/28/Blausen_0561_IsletOfLangerhans.png", tags:["histologie","pancr√©as","insuline"], pathologies:["Diab√®te type 1"] },
          { id:"M09", name:"obesite.png", desc:"Ob√©sit√©", url:"https://upload.wikimedia.org/wikipedia/commons/6/69/Blausen_0682_Obesity.png", tags:["pathologie","ob√©sit√©"], pathologies:["Ob√©sit√©"] },
          { id:"M10", name:"systeme-endocrinien.png", desc:"Syst√®me endocrinien", url:"https://upload.wikimedia.org/wikipedia/commons/f/f4/Blausen_0330_EndocrineSystem_Female2.png", tags:["anatomie","endocrinien"], pathologies:[] },
          { id:"M11", name:"hyperthyroidie.png", desc:"Hyperthyro√Ødie", url:"https://upload.wikimedia.org/wikipedia/commons/f/fd/Blausen_0561_Hyperthyroidism.png", tags:["pathologie","hyperthyro√Ødie"], pathologies:["Hyperthyro√Ødie"] },
          { id:"M12", name:"hypothyroidie.png", desc:"Hypothyro√Ødie", url:"https://upload.wikimedia.org/wikipedia/commons/d/d7/Blausen_0564_Hypothyroidism.png", tags:["pathologie","hypothyro√Ødie"], pathologies:["Hypothyro√Ødie"] },
          { id:"M13", name:"nephropathie-diabetique.png", desc:"N√©phropathie diab√©tique", url:"https://upload.wikimedia.org/wikipedia/commons/8/8f/Blausen_0315_DiabeticNephropathy.png", tags:["pathologie","complications","diab√®te","rein"], pathologies:["Diab√®te type 2"] },
          { id:"M14", name:"neuropathie-diabetique.png", desc:"Neuropathie diab√©tique", url:"https://upload.wikimedia.org/wikipedia/commons/2/22/Blausen_0316_DiabeticNeuropathy.png", tags:["pathologie","complications","diab√®te","nerf"], pathologies:["Diab√®te type 2"] },
          { id:"M15", name:"retinopathie-diabetique.png", desc:"R√©tinopathie diab√©tique", url:"https://upload.wikimedia.org/wikipedia/commons/3/31/Blausen_0317_DiabeticRetinopathy.png", tags:["pathologie","complications","diab√®te","r√©tine"], pathologies:["Diab√®te type 2"] },
        ]
      },
      nephrologie: {
        label: "N√©phrologie", icon: "ü´ò",
        pathologies: ["IRC", "Calculs r√©naux", "Infection urinaire", "Glom√©rulon√©phrite"],
        images: [
          { id:"NE01", name:"rein-anatomie.png", desc:"Anatomie rein", url:"https://upload.wikimedia.org/wikipedia/commons/7/7e/Blausen_0592_KidneyAnatomy_01.png", tags:["anatomie","rein"], pathologies:[] },
          { id:"NE02", name:"nephron.png", desc:"Anatomie n√©phron", url:"https://upload.wikimedia.org/wikipedia/commons/4/41/Blausen_0630_Nephron_Anatomy.png", tags:["anatomie","n√©phron","filtration"], pathologies:["IRC","Glom√©rulon√©phrite"] },
          { id:"NE03", name:"systeme-urinaire.png", desc:"Syst√®me urinaire", url:"https://upload.wikimedia.org/wikipedia/commons/1/17/Blausen_0870_UrinarySystem_Female.png", tags:["anatomie","urinaire"], pathologies:[] },
          { id:"NE04", name:"glomerule.svg", desc:"Glom√©rule", url:"https://upload.wikimedia.org/wikipedia/commons/7/7b/Glomerulus-en.svg", tags:["anatomie","glom√©rule","filtration"], pathologies:["Glom√©rulon√©phrite","IRC"] },
          { id:"NE05", name:"calculs-renaux.png", desc:"Calculs r√©naux", url:"https://upload.wikimedia.org/wikipedia/commons/8/8c/Blausen_0599_KidneyStones.png", tags:["pathologie","lithiase","calculs"], pathologies:["Calculs r√©naux"] },
          { id:"NE06", name:"hemodialyse.png", desc:"H√©modialyse", url:"https://upload.wikimedia.org/wikipedia/commons/e/ea/Blausen_0580_Hemodialysis.png", tags:["traitement","dialyse"], pathologies:["IRC"] },
          { id:"NE07", name:"vessie.png", desc:"Vessie", url:"https://upload.wikimedia.org/wikipedia/commons/5/5f/Blausen_0091_Bladder.png", tags:["anatomie","vessie"], pathologies:["Infection urinaire"] },
          { id:"NE08", name:"infection-urinaire.png", desc:"Infection urinaire", url:"https://upload.wikimedia.org/wikipedia/commons/9/99/Blausen_0880_UrinaryTractInfection.png", tags:["pathologie","infection","urinaire"], pathologies:["Infection urinaire"] },
          { id:"NE09", name:"hydronephrose.png", desc:"Hydron√©phrose", url:"https://upload.wikimedia.org/wikipedia/commons/0/08/Blausen_0465_HydronephrosisRight.png", tags:["pathologie","hydron√©phrose"], pathologies:["Calculs r√©naux"] },
          { id:"NE10", name:"polykystose-renale.png", desc:"Polykystose r√©nale", url:"https://upload.wikimedia.org/wikipedia/commons/3/36/Blausen_0726_PolycysticKidney.png", tags:["pathologie","polykystose","g√©n√©tique"], pathologies:["IRC"] },
        ]
      },
      rhumatologie: {
        label: "Rhumatologie", icon: "ü¶¥",
        pathologies: ["Polyarthrite rhumato√Øde", "Arthrose", "Ost√©oporose", "Goutte", "Lombalgie"],
        images: [
          { id:"RH01", name:"genou-anatomie.png", desc:"Genou anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/0/05/Blausen_0594_KneeAnatomy_Side.png", tags:["anatomie","genou"], pathologies:["Arthrose"] },
          { id:"RH02", name:"osteoporose.png", desc:"Ost√©oporose", url:"https://upload.wikimedia.org/wikipedia/commons/8/80/Blausen_0686_Osteoporosis_01.png", tags:["pathologie","ost√©oporose","os"], pathologies:["Ost√©oporose"] },
          { id:"RH03", name:"articulation-synoviale.svg", desc:"Articulation synoviale", url:"https://upload.wikimedia.org/wikipedia/commons/b/bf/Synovial_joint.svg", tags:["anatomie","articulation","synovie"], pathologies:["Polyarthrite rhumato√Øde","Arthrose"] },
          { id:"RH04", name:"squelette.png", desc:"Vue d'ensemble squelette", url:"https://upload.wikimedia.org/wikipedia/commons/4/4b/Blausen_0790_SkeletalSystem_Overview.png", tags:["anatomie","squelette"], pathologies:[] },
          { id:"RH05", name:"arthrite.png", desc:"Arthrite", url:"https://upload.wikimedia.org/wikipedia/commons/e/e3/Blausen_0597_Arthritis.png", tags:["pathologie","arthrite","inflammation"], pathologies:["Polyarthrite rhumato√Øde"] },
          { id:"RH06", name:"colonne-vertebrale.png", desc:"Colonne vert√©brale", url:"https://upload.wikimedia.org/wikipedia/commons/5/54/Blausen_0822_SpinalColumn.png", tags:["anatomie","rachis","vert√®bres"], pathologies:["Lombalgie"] },
          { id:"RH07", name:"hernie-discale.png", desc:"Hernie discale", url:"https://upload.wikimedia.org/wikipedia/commons/f/f0/Blausen_0484_HerniatedLumbarDisc.png", tags:["pathologie","hernie discale","rachis"], pathologies:["Lombalgie"] },
          { id:"RH08", name:"goutte.png", desc:"Goutte", url:"https://upload.wikimedia.org/wikipedia/commons/0/00/Blausen_0396_Gout.png", tags:["pathologie","goutte","acide urique"], pathologies:["Goutte"] },
          { id:"RH09", name:"fracture.png", desc:"Fracture osseuse", url:"https://upload.wikimedia.org/wikipedia/commons/a/a6/Blausen_0400_FractureTypes.png", tags:["pathologie","fracture","os"], pathologies:["Ost√©oporose"] },
        ]
      },
      hematologie: {
        label: "H√©matologie", icon: "ü©∏",
        pathologies: ["An√©mie", "Leuc√©mie", "Lymphome", "Dr√©panocytose"],
        images: [
          { id:"H01", name:"cellules-sanguines.png", desc:"Cellules sanguines", url:"https://upload.wikimedia.org/wikipedia/commons/2/2e/Blausen_0079_Blood_cells.png", tags:["histologie","sang","cellules"], pathologies:[] },
          { id:"H02", name:"globules-rouges.png", desc:"Globules rouges", url:"https://upload.wikimedia.org/wikipedia/commons/1/1d/Blausen_0761_RedBloodCells.png", tags:["histologie","√©rythrocytes"], pathologies:["An√©mie","Dr√©panocytose"] },
          { id:"H03", name:"globules-blancs.png", desc:"Globules blancs", url:"https://upload.wikimedia.org/wikipedia/commons/3/3c/Blausen_0909_WhiteBloodCells.png", tags:["histologie","leucocytes"], pathologies:["Leuc√©mie"] },
          { id:"H04", name:"plaquettes.png", desc:"Plaquettes sanguines", url:"https://upload.wikimedia.org/wikipedia/commons/0/04/Blausen_0739_Platelets.png", tags:["histologie","plaquettes","h√©mostase"], pathologies:[] },
          { id:"H05", name:"coagulation.svg", desc:"Cascade de coagulation", url:"https://upload.wikimedia.org/wikipedia/commons/e/e1/Coagulation_full.svg", tags:["physiologie","coagulation","h√©mostase"], pathologies:[] },
          { id:"H06", name:"moelle-osseuse.png", desc:"Moelle osseuse", url:"https://upload.wikimedia.org/wikipedia/commons/3/33/Blausen_0095_BoneMarrow.png", tags:["anatomie","moelle osseuse","h√©matopo√Ø√®se"], pathologies:["Leuc√©mie","Lymphome"] },
          { id:"H07", name:"drepanocytose.png", desc:"Dr√©panocytose", url:"https://upload.wikimedia.org/wikipedia/commons/3/38/Sickle_cell_disease.jpg", tags:["pathologie","dr√©panocytose","h√©moglobine S"], pathologies:["Dr√©panocytose"] },
          { id:"H08", name:"rate.png", desc:"Rate anatomie", url:"https://upload.wikimedia.org/wikipedia/commons/0/0c/Blausen_0822_Spleen.png", tags:["anatomie","rate"], pathologies:["Lymphome"] },
          { id:"H09", name:"ganglion-lymphatique.png", desc:"Ganglion lymphatique", url:"https://upload.wikimedia.org/wikipedia/commons/b/b1/Blausen_0623_LymphNode_Anatomy.png", tags:["anatomie","ganglion","lymphatique"], pathologies:["Lymphome"] },
        ]
      },
      dermatologie: {
        label: "Dermatologie", icon: "üß¨",
        pathologies: ["Ecz√©ma", "Psoriasis", "M√©lanome"],
        images: [
          { id:"DE01", name:"peau-coupe.png", desc:"Coupe de la peau", url:"https://upload.wikimedia.org/wikipedia/commons/c/c5/Blausen_0809_Skin_Anatomy.png", tags:["anatomie","peau","couches"], pathologies:[] },
          { id:"DE02", name:"melanome.png", desc:"M√©lanome", url:"https://upload.wikimedia.org/wikipedia/commons/6/6f/Melanoma.jpg", tags:["pathologie","m√©lanome","cancer"], pathologies:["M√©lanome"] },
          { id:"DE03", name:"epiderme.png", desc:"√âpiderme", url:"https://upload.wikimedia.org/wikipedia/commons/3/36/Blausen_0335_EpidermalLayer.png", tags:["anatomie","√©piderme"], pathologies:[] },
          { id:"DE04", name:"glandes-peau.png", desc:"Glandes de la peau", url:"https://upload.wikimedia.org/wikipedia/commons/5/5d/Blausen_0808_Skin_SebaceousGland.png", tags:["anatomie","glandes","s√©bac√©es"], pathologies:[] },
          { id:"DE05", name:"brulure.png", desc:"Degr√©s de br√ªlure", url:"https://upload.wikimedia.org/wikipedia/commons/1/1b/Blausen_0164_BurnDegrees.png", tags:["pathologie","br√ªlure","urgence"], pathologies:[] },
        ]
      },
      ophtalmologie: {
        label: "Ophtalmologie", icon: "üëÅÔ∏è",
        pathologies: ["Glaucome", "Cataracte", "DMLA"],
        images: [
          { id:"O01", name:"oeil-anatomie.png", desc:"Anatomie de l'≈ìil", url:"https://upload.wikimedia.org/wikipedia/commons/7/74/Blausen_0388_EyeAnatomy_01.png", tags:["anatomie","≈ìil"], pathologies:[] },
          { id:"O02", name:"retine.png", desc:"R√©tine", url:"https://upload.wikimedia.org/wikipedia/commons/5/55/Blausen_0389_EyeAnatomy_02.png", tags:["anatomie","r√©tine"], pathologies:["DMLA"] },
          { id:"O03", name:"glaucome.png", desc:"Glaucome", url:"https://upload.wikimedia.org/wikipedia/commons/f/f3/Blausen_0390_Glaucoma_01.png", tags:["pathologie","glaucome","pression"], pathologies:["Glaucome"] },
          { id:"O04", name:"cataracte.png", desc:"Cataracte", url:"https://upload.wikimedia.org/wikipedia/commons/b/b7/Blausen_0163_Cataract.png", tags:["pathologie","cataracte","cristallin"], pathologies:["Cataracte"] },
          { id:"O05", name:"myopie-hypermetropie.svg", desc:"Myopie et hyperm√©tropie", url:"https://upload.wikimedia.org/wikipedia/commons/4/48/Myopia_and_hyperopia.svg", tags:["pathologie","r√©fraction","myopie"], pathologies:[] },
        ]
      },
      infectiologie: {
        label: "Infectiologie", icon: "ü¶†",
        pathologies: ["VIH", "Tuberculose", "Sepsis", "COVID-19", "M√©ningite bact√©rienne"],
        images: [
          { id:"I01", name:"bacterie.png", desc:"Bact√©rie", url:"https://upload.wikimedia.org/wikipedia/commons/b/b5/Blausen_0068_Bacterium.png", tags:["microbiologie","bact√©rie"], pathologies:[] },
          { id:"I02", name:"virus.png", desc:"Virus", url:"https://upload.wikimedia.org/wikipedia/commons/c/c0/Blausen_0898_Virus.png", tags:["microbiologie","virus"], pathologies:[] },
          { id:"I03", name:"immunoglobuline.png", desc:"Immunoglobuline", url:"https://upload.wikimedia.org/wikipedia/commons/8/82/Blausen_0467_Immunoglobulin.png", tags:["immunologie","anticorps"], pathologies:[] },
          { id:"I04", name:"phagocytose.png", desc:"Phagocytose", url:"https://upload.wikimedia.org/wikipedia/commons/d/d9/Blausen_0699_Phagocytosis.png", tags:["immunologie","phagocytose","macrophage"], pathologies:[] },
          { id:"I05", name:"vih.png", desc:"VIH", url:"https://upload.wikimedia.org/wikipedia/commons/7/78/Blausen_0463_HIV_Labels.png", tags:["pathologie","VIH","r√©trovirus"], pathologies:["VIH"] },
          { id:"I06", name:"tuberculose.png", desc:"Tuberculose", url:"https://upload.wikimedia.org/wikipedia/commons/5/50/Blausen_0868_Tuberculosis.png", tags:["pathologie","tuberculose","BK"], pathologies:["Tuberculose"] },
          { id:"I07", name:"sepsis.png", desc:"Sepsis", url:"https://upload.wikimedia.org/wikipedia/commons/9/98/Blausen_0779_Sepsis.png", tags:["pathologie","sepsis","urgence"], pathologies:["Sepsis"] },
          { id:"I08", name:"coronavirus.svg", desc:"Structure coronavirus", url:"https://upload.wikimedia.org/wikipedia/commons/6/6e/Coronavirus_virion_structure.svg", tags:["microbiologie","coronavirus","COVID"], pathologies:["COVID-19"] },
          { id:"I09", name:"meningite-infectio.png", desc:"M√©ningite bact√©rienne", url:"https://upload.wikimedia.org/wikipedia/commons/8/85/Blausen_0631_Meningitis.png", tags:["pathologie","m√©ningite","bact√©rie"], pathologies:["M√©ningite bact√©rienne"] },
        ]
      },
      orl: {
        label: "ORL", icon: "üëÇ",
        pathologies: ["Otite", "Sinusite", "Angine", "Surdit√©"],
        images: [
          { id:"ORL01", name:"oreille-anatomie.png", desc:"Anatomie de l'oreille", url:"https://upload.wikimedia.org/wikipedia/commons/e/e0/Blausen_0328_EarAnatomy.png", tags:["anatomie","oreille"], pathologies:["Otite","Surdit√©"] },
          { id:"ORL02", name:"oreille-interne.png", desc:"Oreille interne", url:"https://upload.wikimedia.org/wikipedia/commons/7/70/Blausen_0329_EarAnatomy_InternalEar.png", tags:["anatomie","oreille interne","cochl√©e"], pathologies:["Surdit√©"] },
          { id:"ORL03", name:"oreille-moyenne.png", desc:"Oreille moyenne", url:"https://upload.wikimedia.org/wikipedia/commons/d/dc/Blausen_0330_EarAnatomy_MiddleEar.png", tags:["anatomie","oreille moyenne"], pathologies:["Otite"] },
          { id:"ORL04", name:"cavite-nasale.png", desc:"Cavit√© nasale", url:"https://upload.wikimedia.org/wikipedia/commons/f/f0/Blausen_0682_NasalCavity.png", tags:["anatomie","nez","sinus"], pathologies:["Sinusite"] },
          { id:"ORL05", name:"amygdalite.png", desc:"Amygdalite", url:"https://upload.wikimedia.org/wikipedia/commons/b/b7/Blausen_0864_Tonsillitis.png", tags:["pathologie","angine","amygdales"], pathologies:["Angine"] },
          { id:"ORL06", name:"amygdales-adenoides.png", desc:"Amygdales et v√©g√©tations", url:"https://upload.wikimedia.org/wikipedia/commons/5/58/Blausen_0861_Tonsils%26Adenoids.png", tags:["anatomie","amygdales","v√©g√©tations"], pathologies:["Angine"] },
          { id:"ORL07", name:"sinusite.png", desc:"Sinusite", url:"https://upload.wikimedia.org/wikipedia/commons/c/c9/Blausen_0800_Sinusitis.png", tags:["pathologie","sinusite","sinus"], pathologies:["Sinusite"] },
          { id:"ORL08", name:"surdite-conduction.png", desc:"Surdit√© de conduction", url:"https://upload.wikimedia.org/wikipedia/commons/9/91/Blausen_0579_HearingLoss_Conductive.png", tags:["pathologie","surdit√©","conduction"], pathologies:["Surdit√©"] },
        ]
      },
      servier_kits: {
        label: "Kits Servier (PPTX)", icon: "üì¶",
        pathologies: [],
        images: [
          { id:"S01", name:"SMART-Heart-physiology.pptx", desc:"Kit Servier ‚Äî Physiologie cardiaque", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Heart-physiology.pptx", tags:["kit","c≈ìur","physiologie"], pathologies:[] },
          { id:"S02", name:"SMART-Heart-pathophysiology.pptx", desc:"Kit Servier ‚Äî Pathophysiologie cardiaque", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Heart-pathophysiology.pptx", tags:["kit","c≈ìur","physiopathologie"], pathologies:[] },
          { id:"S03", name:"SMART-Arteries-physiology.pptx", desc:"Kit Servier ‚Äî Physiologie art√©rielle", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Arteries-physiology.pptx", tags:["kit","art√®res","physiologie"], pathologies:[] },
          { id:"S04", name:"SMART-Arteries-pathophysiology.pptx", desc:"Kit Servier ‚Äî Pathophysiologie art√©rielle", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Arteries-pathophysiology.pptx", tags:["kit","art√®res","physiopathologie"], pathologies:[] },
          { id:"S05", name:"SMART-Arteries-atherothrombosis.pptx", desc:"Kit Servier ‚Äî Ath√©rothrombose", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Arteries-atherothrombosis.pptx", tags:["kit","ath√©rothrombose"], pathologies:[] },
          { id:"S06", name:"SMART-Nervous-system.pptx", desc:"Kit Servier ‚Äî Syst√®me nerveux", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Nervous-system.pptx", tags:["kit","neurologie"], pathologies:[] },
          { id:"S07", name:"SMART-Neural-cells.pptx", desc:"Kit Servier ‚Äî Cellules neurales", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Neural-cells.pptx", tags:["kit","neurone"], pathologies:[] },
          { id:"S08", name:"SMART-Respiratory-system.pptx", desc:"Kit Servier ‚Äî Syst√®me respiratoire", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Respiratory-system.pptx", tags:["kit","respiratoire"], pathologies:[] },
          { id:"S09", name:"SMART-Digestive-system.pptx", desc:"Kit Servier ‚Äî Syst√®me digestif", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Digestive-system.pptx", tags:["kit","digestif"], pathologies:[] },
          { id:"S10", name:"SMART-Urinary-system.pptx", desc:"Kit Servier ‚Äî Syst√®me urinaire", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Urinary-system.pptx", tags:["kit","urinaire"], pathologies:[] },
          { id:"S11", name:"SMART-Diabetes.pptx", desc:"Kit Servier ‚Äî Diab√®te", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Diabetes.pptx", tags:["kit","diab√®te"], pathologies:[] },
          { id:"S12", name:"SMART-Endocrinology.pptx", desc:"Kit Servier ‚Äî Endocrinologie", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Endocrinology.pptx", tags:["kit","endocrinologie"], pathologies:[] },
          { id:"S13", name:"SMART-Blood-immunology.pptx", desc:"Kit Servier ‚Äî Sang et immunologie", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Blood-immunology.pptx", tags:["kit","h√©matologie","immunologie"], pathologies:[] },
          { id:"S14", name:"SMART-Veins.pptx", desc:"Kit Servier ‚Äî Veines", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Veins.pptx", tags:["kit","veines"], pathologies:[] },
          { id:"S15", name:"SMART-Bones.pptx", desc:"Kit Servier ‚Äî Os", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Bones.pptx", tags:["kit","os","rhumatologie"], pathologies:[] },
          { id:"S16", name:"SMART-Muscles.pptx", desc:"Kit Servier ‚Äî Muscles", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Muscles.pptx", tags:["kit","muscles"], pathologies:[] },
          { id:"S17", name:"SMART-Oncology.pptx", desc:"Kit Servier ‚Äî Oncologie", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Oncology.pptx", tags:["kit","oncologie","cancer"], pathologies:[] },
          { id:"S18", name:"SMART-Infectiology.pptx", desc:"Kit Servier ‚Äî Infectiologie", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Infectiology.pptx", tags:["kit","infectiologie"], pathologies:[] },
          { id:"S19", name:"SMART-Dermatology.pptx", desc:"Kit Servier ‚Äî Dermatologie", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Dermatology.pptx", tags:["kit","dermatologie"], pathologies:[] },
          { id:"S20", name:"SMART-Ophthalmology.pptx", desc:"Kit Servier ‚Äî Ophtalmologie", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Ophthalmology.pptx", tags:["kit","ophtalmologie"], pathologies:[] },
          { id:"S21", name:"SMART-ENT.pptx", desc:"Kit Servier ‚Äî ORL", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-ENT.pptx", tags:["kit","ORL"], pathologies:[] },
          { id:"S22", name:"SMART-Risk-Factors.pptx", desc:"Kit Servier ‚Äî Facteurs de risque", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Risk-Factors.pptx", tags:["kit","facteurs de risque"], pathologies:[] },
          { id:"S23", name:"SMART-Lipids.pptx", desc:"Kit Servier ‚Äî Lipides", url:"https://smart.servier.com/wp-content/uploads/2016/10/SMART-Lipids.pptx", tags:["kit","lipides","cholest√©rol"], pathologies:[] },
          { id:"S24", name:"ServierMedicalArt-all-kits.zip", desc:"TOUS les kits Servier (170 Mo)", url:"https://smart.servier.com/wp-content/uploads/ServierMedicalArt-all-kits.zip", tags:["kit","archive","complet"], pathologies:[] },
        ]
      }
    };

    // ============================================================
    // STATE
    // ============================================================
    let allImages = [];
    let filteredImages = [];
    let favorites = JSON.parse(localStorage.getItem('medref_favs') || '[]');
    let urlStatus = {};
    let activeCategory = 'all';
    let viewMode = 'grid';
    let selectMode = false;
    let selectedIds = new Set();
    let showFavsOnly = false;
    let allTags = new Set();

    // ============================================================
    // INIT
    // ============================================================
    function init() {
        // Flatten database
        for (const [catKey, catData] of Object.entries(DB)) {
            for (const img of catData.images) {
                allImages.push({
                    ...img,
                    category: catKey,
                    categoryLabel: catData.label,
                    categoryIcon: catData.icon,
                    format: getFormat(img.name),
                    license: img.url.includes('wikimedia') ? 'CC BY 3.0 / CC BY-SA' : 'CC BY 4.0 Servier',
                });
                img.tags.forEach(t => allTags.add(t));
            }
        }

        // Build category chips
        buildCategoryChips();
        buildTagFilter();

        // Stats
        document.getElementById('totalCount').textContent = allImages.length;
        document.getElementById('catCount').textContent = Object.keys(DB).length;

        applyFilters();
    }

    function getFormat(name) {
        const ext = name.split('.').pop().toLowerCase();
        return ext;
    }

    // ============================================================
    // CATEGORY CHIPS
    // ============================================================
    function buildCategoryChips() {
        const container = document.getElementById('categoryChips');
        let html = `<button class="chip active" data-cat="all" onclick="setCategory('all')">Toutes <span class="count">${allImages.length}</span></button>`;
        for (const [key, data] of Object.entries(DB)) {
            html += `<button class="chip" data-cat="${key}" onclick="setCategory('${key}')">${data.icon} ${data.label} <span class="count">${data.images.length}</span></button>`;
        }
        container.innerHTML = html;
    }

    function buildTagFilter() {
        const select = document.getElementById('tagFilter');
        const sorted = [...allTags].sort((a,b) => a.localeCompare(b, 'fr'));
        sorted.forEach(tag => {
            select.innerHTML += `<option value="${tag}">${tag}</option>`;
        });
    }

    function setCategory(cat) {
        activeCategory = cat;
        document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', c.dataset.cat === cat));
        applyFilters();
    }

    // ============================================================
    // FILTERS
    // ============================================================
    function applyFilters() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        const formatFilter = document.getElementById('formatFilter').value;
        const tagFilter = document.getElementById('tagFilter').value;

        filteredImages = allImages.filter(img => {
            if (activeCategory !== 'all' && img.category !== activeCategory) return false;
            if (showFavsOnly && !favorites.includes(img.id)) return false;
            if (formatFilter && img.format !== formatFilter) return false;
            if (tagFilter && !img.tags.includes(tagFilter)) return false;
            if (query) {
                const haystack = [img.name, img.desc, img.categoryLabel, ...img.tags, ...(img.pathologies||[])].join(' ').toLowerCase();
                const words = query.split(/\s+/);
                return words.every(w => haystack.includes(w));
            }
            return true;
        });

        document.getElementById('filteredCount').textContent = filteredImages.length;
        renderGrid();
    }

    function filterFavorites() {
        showFavsOnly = !showFavsOnly;
        document.getElementById('favFilterBtn').classList.toggle('btn-accent', showFavsOnly);
        applyFilters();
    }

    // ============================================================
    // RENDER
    // ============================================================
    function renderGrid() {
        const grid = document.getElementById('imageGrid');

        if (filteredImages.length === 0) {
            grid.innerHTML = `<div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <p>Aucune image trouv√©e</p>
            </div>`;
            return;
        }

        const isPptx = (name) => name.endsWith('.pptx') || name.endsWith('.zip');
        grid.innerHTML = filteredImages.map((img, i) => {
            const isFav = favorites.includes(img.id);
            const status = urlStatus[img.id] || '';
            const selClass = selectedIds.has(img.id) ? 'selected' : '';
            const selectable = selectMode ? 'selectable' : '';
            const delay = Math.min(i * 30, 600);

            return `<div class="img-card ${selClass} ${selectable}" style="animation-delay:${delay}ms" data-id="${img.id}">
                <div class="select-check">‚úì</div>
                ${status ? `<div class="status-dot ${status}"></div>` : ''}
                <button class="fav-btn ${isFav ? 'faved' : ''}" onclick="event.stopPropagation();toggleFav('${img.id}')" title="Favori">
                    ${isFav ? '‚òÖ' : '‚òÜ'}
                </button>
                <div class="thumb-wrap" onclick="${selectMode ? `toggleSelect('${img.id}')` : `openModal('${img.id}')`}">
                    ${isPptx(img.name) 
                        ? `<div class="thumb-placeholder">üì¶ ${img.format.toUpperCase()}<br><small>${img.name}</small></div>` 
                        : `<img src="${img.url}" alt="${img.desc}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=thumb-placeholder>‚ö†Ô∏è Image indisponible</div>'">`
                    }
                </div>
                <div class="card-body">
                    <div class="card-title">${img.desc}</div>
                    <div class="card-desc">${img.categoryIcon} ${img.categoryLabel} ¬∑ ${img.format.toUpperCase()}</div>
                    <div class="card-tags">
                        ${img.tags.slice(0,3).map(t => `<span class="tag">${t}</span>`).join('')}
                        ${img.pathologies.length ? img.pathologies.slice(0,2).map(p => `<span class="pathology-badge">${p}</span>`).join('') : ''}
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-sm" onclick="event.stopPropagation();copyUrl('${img.id}')">üìã URL</button>
                        <button class="btn btn-sm" onclick="event.stopPropagation();window.open('${img.url}','_blank')">‚Üó Ouvrir</button>
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    // ============================================================
    // VIEW MODE
    // ============================================================
    function setView(mode) {
        viewMode = mode;
        document.getElementById('imageGrid').classList.toggle('list-view', mode === 'list');
        document.getElementById('gridViewBtn').classList.toggle('active', mode === 'grid');
        document.getElementById('listViewBtn').classList.toggle('active', mode === 'list');
    }

    // ============================================================
    // FAVORITES
    // ============================================================
    function toggleFav(id) {
        const idx = favorites.indexOf(id);
        if (idx >= 0) favorites.splice(idx, 1);
        else favorites.push(id);
        localStorage.setItem('medref_favs', JSON.stringify(favorites));
        applyFilters();
    }

    // ============================================================
    // SELECTION MODE
    // ============================================================
    function toggleSelectMode() {
        selectMode = !selectMode;
        document.getElementById('selectModeBtn').classList.toggle('btn-accent', selectMode);
        if (!selectMode) clearSelection();
        applyFilters();
    }

    function toggleSelect(id) {
        if (selectedIds.has(id)) selectedIds.delete(id);
        else selectedIds.add(id);
        updateSelectionBar();
        applyFilters();
    }

    function clearSelection() {
        selectedIds.clear();
        updateSelectionBar();
        applyFilters();
    }

    function updateSelectionBar() {
        const bar = document.getElementById('selectionBar');
        bar.classList.toggle('show', selectedIds.size > 0);
        document.getElementById('selCount').textContent = selectedIds.size;
    }

    function exportSelected() {
        const sel = allImages.filter(img => selectedIds.has(img.id));
        const json = JSON.stringify(sel, null, 2);
        document.getElementById('exportArea').value = json;
        document.getElementById('exportPanel').classList.add('open');
        showToast(`${sel.length} images export√©es`);
    }

    // ============================================================
    // MODAL
    // ============================================================
    function openModal(id) {
        const img = allImages.find(i => i.id === id);
        if (!img) return;

        document.getElementById('modalTitle').textContent = img.desc;
        const modalImg = document.getElementById('modalImg');
        if (img.name.endsWith('.pptx') || img.name.endsWith('.zip')) {
            modalImg.style.display = 'none';
            document.querySelector('.modal-img-wrap').innerHTML = `<div style="text-align:center;color:var(--text-muted);padding:40px;"><div style="font-size:3rem;">üì¶</div><p>${img.name}</p><p style="font-size:0.8rem;margin-top:8px;">Fichier t√©l√©chargeable</p></div>`;
        } else {
            modalImg.style.display = '';
            modalImg.src = img.url;
            document.querySelector('.modal-img-wrap').innerHTML = '';
            document.querySelector('.modal-img-wrap').appendChild(modalImg);
        }

        const meta = document.getElementById('modalMeta');
        meta.innerHTML = `
            <span class="label">Fichier</span><span class="value">${img.name}</span>
            <span class="label">Format</span><span class="value">${img.format.toUpperCase()}</span>
            <span class="label">Sp√©cialit√©</span><span class="value">${img.categoryIcon} ${img.categoryLabel}</span>
            <span class="label">Licence</span><span class="value">${img.license}</span>
            <span class="label">Tags</span><span class="value">${img.tags.join(', ')}</span>
            ${img.pathologies.length ? `<span class="label">Pathologies</span><span class="value">${img.pathologies.join(', ')}</span>` : ''}
            <span class="label">URL</span><span class="value"><a href="${img.url}" target="_blank">${img.url.substring(0, 80)}‚Ä¶</a></span>
        `;

        document.getElementById('modalActions').innerHTML = `
            <button class="btn" onclick="navigator.clipboard.writeText('${img.url}');showToast('URL copi√©e')">üìã Copier URL</button>
            <button class="btn" onclick="window.open('${img.url}','_blank')">‚Üó Ouvrir en grand</button>
            <button class="btn" onclick="downloadImage('${img.url}','${img.name}')">‚¨á T√©l√©charger</button>
        `;

        document.getElementById('modalOverlay').classList.add('open');
        document.body.style.overflow = 'hidden';
    }

    function closeModal(e) {
        if (e && e.target !== e.currentTarget) return;
        document.getElementById('modalOverlay').classList.remove('open');
        document.body.style.overflow = '';
    }

    // ============================================================
    // URL CHECKER
    // ============================================================
    function toggleChecker() {
        document.getElementById('checkerPanel').classList.toggle('open');
    }

    async function runUrlCheck() {
        const total = allImages.length;
        let checked = 0, ok = 0, fail = 0;
        urlStatus = {};

        document.getElementById('checkTotal').textContent = '0';
        document.getElementById('checkOk').textContent = '0';
        document.getElementById('checkFail').textContent = '0';

        for (const img of allImages) {
            urlStatus[img.id] = 'checking';
            applyFilters();
            try {
                const resp = await fetch(img.url, { method: 'HEAD', mode: 'no-cors' });
                urlStatus[img.id] = 'ok';
                ok++;
            } catch {
                urlStatus[img.id] = 'broken';
                fail++;
            }
            checked++;
            document.getElementById('checkerBar').style.width = `${(checked/total)*100}%`;
            document.getElementById('checkTotal').textContent = checked;
            document.getElementById('checkOk').textContent = ok;
            document.getElementById('checkFail').textContent = fail;
        }
        applyFilters();
        showToast(`V√©rification termin√©e: ${ok} OK, ${fail} cass√©es`);
    }

    // ============================================================
    // EXPORT
    // ============================================================
    function toggleExport() {
        document.getElementById('exportPanel').classList.toggle('open');
    }

    function exportData() {
        const data = selectedIds.size > 0 
            ? allImages.filter(img => selectedIds.has(img.id))
            : filteredImages;
        document.getElementById('exportArea').value = JSON.stringify(data, null, 2);
        document.getElementById('exportPanel').classList.add('open');
    }

    function copyExport() {
        navigator.clipboard.writeText(document.getElementById('exportArea').value);
        showToast('JSON copi√© dans le presse-papier');
    }

    function downloadExport() {
        const blob = new Blob([document.getElementById('exportArea').value], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'medref-images-export.json';
        a.click();
    }

    // ============================================================
    // UTILS
    // ============================================================
    function copyUrl(id) {
        const img = allImages.find(i => i.id === id);
        if (img) {
            navigator.clipboard.writeText(img.url);
            showToast('URL copi√©e');
        }
    }

    function downloadImage(url, name) {
        const a = document.createElement('a');
        a.href = url;
        a.download = name;
        a.target = '_blank';
        a.click();
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2500);
    }

    // Keyboard
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeModal();
    });

    // Init
    init();
    </script>
</body>
</html>
